homework:
    image: jiegec/router-lab-x86_64
    script:
        - mkdir logs
        - make -C Homework/checksum
        - (cd Homework/checksum && python3 grade.py | tee ../../logs/checksum.log)
        - make -C Homework/forwarding
        - (cd Homework/forwarding && python3 grade.py | tee ../../logs/forwarding.log)
        - make -C Homework/lookup
        - (cd Homework/lookup && python3 grade.py | tee ../../logs/lookup.log)
        - make -C Homework/protocol
        - (cd Homework/protocol && python3 grade.py | tee ../../logs/protocol.log)
    artifacts:
        paths:
            - logs
        when: always
        expire_in: 1 year

router:
    image: debian:stretch
    tags:
        - arm64
    before_script:
        - sed -i 's/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list
        - sed -i 's/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list
        - apt update
        - apt install -y python3-pip python3-py python3-lxml libpcap-dev libxml2-dev libxslt-dev
        - pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple pyshark
    script:
        - make -C Homework/router/r1
        - make -C Homework/router/r2
        - make -C Homework/router/r3
    artifacts:
        paths:
            - Homework/router/r1/router
            - Homework/router/r2/router
            - Homework/router/r3/router
        when: always
        expire_in: 1 year
